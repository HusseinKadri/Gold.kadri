<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>أسعار الذهب المباشرة في الكويت</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
        margin: 0;
        padding: 20px;
        color: #333;
    }
    h1 {
        text-align: center;
        color: #b6862e;
    }
    .container {
        max-width: 600px;
        margin: 0 auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .price-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
    }
    .price-row:last-child {
        border-bottom: none;
    }
    .label {
        font-weight: bold;
    }
    .value {
        font-size: 1.1em;
    }
    .update-time {
        text-align: center;
        margin-top: 10px;
        font-size: 0.9em;
        color: #555;
    }
    .note {
        margin-top: 20px;
        font-size: 0.8em;
        color: #666;
        line-height: 1.4;
    }
</style>
</head>
<body>
<div class="container">
    <h1>أسعار الذهب المباشرة</h1>
    <div class="price-row"><span class="label">سعر الأونصة (دينار كويتي):</span><span class="value" id="ounceKWD">–</span></div>
    <div class="price-row"><span class="label">سعر غرام عيار 24:</span><span class="value" id="gram24">–</span></div>
    <div class="price-row"><span class="label">سعر غرام عيار 22:</span><span class="value" id="gram22">–</span></div>
    <div class="price-row"><span class="label">سعر غرام عيار 21:</span><span class="value" id="gram21">–</span></div>
    <div class="price-row"><span class="label">سعر غرام عيار 18:</span><span class="value" id="gram18">–</span></div>
    <div class="update-time" id="updateTime">جاري التحديث...</div>
    <div class="note">
        <p>تعتمد هذه الصفحة على بيانات الأسعار اللحظية من بورصة Swissquote عبر واجهة الويب العامة وبيانات سعر الصرف من <a href="https://www.exchangerate-api.com/" target="_blank">ExchangeRate-API</a>. يتم تحديث البيانات كل ثانية بشكل آلي بدون تدخل المستخدم. يتم تحويل السعر إلى الغرام باستخدام معيار أن الأونصة الترويسية تساوي 31.1034768 غرام وفقًا لوزارة الخزانة الأمريكية【781259125788291†L114-L116】، كما يتم حساب نقاوة العيارات استنادًا إلى أن القيراط الواحد يساوي جزءًا واحدًا من أصل 24 جزءًا من الذهب الخالص【109621643765384†L772-L783】.</p>
    </div>
</div>
<script>
const goldUrl = 'https://corsproxy.io/?https://forex-data-feed.swissquote.com/public-quotes/bboquotes/instrument/XAU/USD';
const ratesUrl = 'https://corsproxy.io/?https://open.er-api.com/v6/latest';

// تحويل العيارات
function calculateCaratPrice(baseGramPrice, carat) {
    return baseGramPrice * (carat / 24);
}

async function fetchGoldPriceUSD() {
    const response = await fetch(goldUrl);
    const data = await response.json();
    // استخراج متوسط السعر بين العرض والطلب لجميع مصادر الأسعار
    let total = 0;
    let count = 0;
    data.forEach(item => {
        item.spreadProfilePrices.forEach(sp => {
            total += (sp.bid + sp.ask) / 2;
            count++;
        });
    });
    const averagePrice = total / count;
    return averagePrice;
}

async function fetchUSDtoKWD() {
    const response = await fetch(ratesUrl);
    const data = await response.json();
    const kwdRate = data.rates.KWD;
    return kwdRate;
}

async function updatePrices() {
    try {
        const [goldUSD, kwdRate] = await Promise.all([fetchGoldPriceUSD(), fetchUSDtoKWD()]);
        // تحويل السعر إلى دينار كويتي
        const goldKWD = goldUSD * kwdRate;
        // تحويل الأونصة إلى الغرام (أونصة ترويسية = 31.1034768 غرام)
        const pricePerGramUSD = goldUSD / 31.1034768;
        const pricePerGramKWD = goldKWD / 31.1034768;
        // حساب أسعار العيارات
        const price24 = calculateCaratPrice(pricePerGramKWD, 24);
        const price22 = calculateCaratPrice(pricePerGramKWD, 22);
        const price21 = calculateCaratPrice(pricePerGramKWD, 21);
        const price18 = calculateCaratPrice(pricePerGramKWD, 18);
        // تحديث الصفحة
        document.getElementById('ounceKWD').textContent = goldKWD.toFixed(3) + ' د.ك';
        document.getElementById('gram24').textContent = price24.toFixed(3) + ' د.ك';
        document.getElementById('gram22').textContent = price22.toFixed(3) + ' د.ك';
        document.getElementById('gram21').textContent = price21.toFixed(3) + ' د.ك';
        document.getElementById('gram18').textContent = price18.toFixed(3) + ' د.ك';
        const now = new Date();
        document.getElementById('updateTime').textContent = 'آخر تحديث: ' + now.toLocaleTimeString('ar-KW');
    } catch (error) {
        document.getElementById('updateTime').textContent = 'خطأ في جلب البيانات';
        console.error('حدث خطأ أثناء جلب بيانات الأسعار:', error);
    }
}

// التحديث كل ثانية
updatePrices();
setInterval(updatePrices, 1000);
</script>
</body>
</html>
